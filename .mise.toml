# mise-en-place (mise) configuration
# Tool version management and project setup
# Install mise: https://mise.jdx.dev/getting-started.html

[tools]
# Java 21 - Required for the project
java = "21.0.0"

# Gradle - Build tool
gradle = "8.5"

# Docker - For containerized services
# Note: Docker version managed by system, not mise

# Ollama - LLM runtime
# Note: Ollama installed separately, not via mise

[env]
# Project-specific environment variables
# These are loaded when entering the project directory

# Database Configuration
DB_USERNAME = "postgres"
DB_PASSWORD = "postgres"

# Redis Configuration  
REDIS_HOST = "localhost"
REDIS_PORT = "6379"

# Ollama Configuration
OLLAMA_BASE_URL = "http://localhost:11434"
OLLAMA_MODEL = "llama3.2:3b"

# Repository Clone Path
REPO_CLONE_PATH = "./repos"

# Essential development workflow tasks
# For complete command reference, see COMMANDS.md

[tasks.setup]
description = "Full project setup - installs mise, tools, and starts services"
# Note: This task is typically run via the setup scripts which handle mise installation
# The scripts then call mise tasks for the actual setup work
run = "echo 'Please run: ./scripts/setup.ps1 (Windows) or ./scripts/setup.sh (Linux/Mac)'"

[tasks.start-services]
description = "Start Docker services (PostgreSQL and Redis)"
run_windows = "powershell -File scripts/start-services.ps1"
run = "bash scripts/start-services.sh"

[tasks.stop-services]
description = "Stop Docker services"
run_windows = "powershell -File scripts/stop-services.ps1"
run = "bash scripts/stop-services.sh"

[tasks.build]
description = "Build the project (without tests)"
run_windows = "powershell -File scripts/gradle-build.ps1"
run = "bash -c 'if [ -f gradlew ]; then ./gradlew build -x test; else gradle build -x test; fi'"

[tasks.build-all]
description = "Build the project with tests"
run_windows = "powershell -File scripts/gradle-build.ps1 -WithTests"
run = "bash -c 'if [ -f gradlew ]; then ./gradlew build; else gradle build; fi'"

[tasks.test]
description = "Run all tests"
run_windows = "powershell -File scripts/gradle-test.ps1"
run = "bash -c 'if [ -f gradlew ]; then ./gradlew test; else gradle test; fi'"

[tasks.test-unit]
description = "Run only unit tests"
run_windows = "powershell -File scripts/gradle-test.ps1 -UnitOnly"
run = "bash -c 'if [ -f gradlew ]; then ./gradlew test --tests \"*Test\" --exclude-tests \"*ComponentTest\"; else gradle test --tests \"*Test\" --exclude-tests \"*ComponentTest\"; fi'"

[tasks.test-component]
description = "Run only component tests (requires Docker)"
run_windows = "powershell -File scripts/gradle-test.ps1 -ComponentOnly"
run = "bash -c 'if [ -f gradlew ]; then ./gradlew test --tests \"com.bugbounty.component.*\"; else gradle test --tests \"com.bugbounty.component.*\"; fi'"

[tasks.run]
description = "Run the application"
run_windows = "powershell -File scripts/gradle-run.ps1"
run = "bash -c 'if [ -f gradlew ]; then ./gradlew bootRun; else gradle bootRun; fi'"

[tasks.clean]
description = "Clean build artifacts"
run_windows = "powershell -File scripts/gradle-clean.ps1"
run = "bash -c 'if [ -f gradlew ]; then ./gradlew clean; else gradle clean; fi'"

[tasks.docker-logs]
description = "View Docker service logs (follow mode)"
run = "docker compose logs -f"

[tasks.docker-ps]
description = "Check Docker services status"
run = "docker compose ps"

[tasks.db-connect]
description = "Connect to PostgreSQL database"
run = "docker exec -it bugbounty-postgres psql -U postgres -d bugbounty"

[tasks.redis-connect]
description = "Connect to Redis CLI"
run = "docker exec -it bugbounty-redis redis-cli"

[tasks.health]
description = "Check application health (requires app to be running)"
run = "curl http://localhost:8080/actuator/health"

